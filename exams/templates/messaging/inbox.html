{% extends "base.html" %}
{% load static %}
{% load humanize %}
{% block content %}
<div class="container mx-auto p-4">
  <h1 class="text-2xl font-bold mb-4">Inbox</h1>

  <!-- Stats -->
  <div class="mb-4 text-sm text-gray-700">
    <span class="font-medium">{{ total_count }}</span> total messages â€¢
    <span class="font-medium text-red-600">{{ unread_count }}</span> unread
  </div>

  <!-- Inbox List -->
  <div class="space-y-3">
    {% for message in messages %}
    <div class="flex items-start p-4 rounded-lg shadow {% if message.sender == active_user %}bg-gray-100{% endif %}">
      <!-- Profile Image -->
      <img src="{% if message.sender.profile.profile_image.url %}{{ message.sender.profile.profile_image.url }}{% else %}{% static 'default_avatar.png' %}{% endif %}" 
           alt="{{ message.sender.username }}"
           class="w-10 h-10 rounded-full mr-4 border">

      <div class="flex-1">
        <!-- Sender & Time -->
        <div class="flex justify-between">
          <h2 class="font-semibold">{{ message.sender.username }}</h2>
          <span class="text-xs text-gray-500">{{ message.timestamp|naturaltime }}</span>
        </div>

        <!-- Message Preview -->
        <p class="text-sm text-gray-800 mt-1">
          {{ message.content|truncatechars:60 }}
        </p>

        <!-- Badge for unread -->
        {% if not message.is_read %}
        <span class="inline-block bg-red-500 text-white text-xs font-semibold mt-2 px-2 py-1 rounded-full">
          New
        </span>
        {% endif %}

        <!-- Link to view or reply -->
        <div class="mt-2">
          {% if message.sender != request.user %}
            <a href="{% url 'exams:chat_view' username=message.sender.username %}" class="text-blue-600 hover:underline">View & Reply</a>
          {% else %}
            <a href="{% url 'exams:chat_view' username=message.receiver.username %}" class="text-blue-600 hover:underline">View & Reply</a>
          {% endif %}
        </div>
      </div>
    </div>
    {% empty %}
    <p class="text-gray-600">No messages yet.</p>
    {% endfor %}
  </div>
</div>
{% endblock %}